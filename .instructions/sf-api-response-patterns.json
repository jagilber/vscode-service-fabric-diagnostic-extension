{
  "id": "sf-api-response-patterns",
  "title": "Service Fabric API Response Patterns",
  "body": "## API Response Format\n\n### Paged Response Pattern (CRITICAL)\nAll Service Fabric list operations return **paged responses**, not arrays directly.\n\n```typescript\n// ❌ WRONG - treats response as array\nconst nodes = await sfApi.getNodeInfoList();\nfor (const node of nodes) { ... }\n\n// ✅ CORRECT - access .items property\nconst response = await sfApi.getNodeInfoList();\nconst nodes = response.items || [];\nfor (const node of nodes) { ... }\n```\n\n### Paged Response Types\n\n1. **PagedNodeInfoList**\n```typescript\ninterface PagedNodeInfoList {\n  continuationToken?: string;\n  items?: NodeInfo[];\n}\n```\n\n2. **PagedApplicationInfoList**\n```typescript\ninterface PagedApplicationInfoList {\n  continuationToken?: string;\n  items?: ApplicationInfo[];\n}\n```\n\n3. **PagedServiceInfoList**\n```typescript\ninterface PagedServiceInfoList {\n  continuationToken?: string;\n  items?: ServiceInfoUnion[];\n}\n```\n\n### API Methods Returning Paged Responses\n- `getNodeInfoList()` → PagedNodeInfoList\n- `getApplicationInfoList()` → PagedApplicationInfoList\n- `getServiceInfoList(appId)` → PagedServiceInfoList\n- `getApplicationTypeInfoList()` → PagedApplicationTypeInfoList\n\n### Continuation Token Pattern\nFor large result sets, use continuation tokens:\n\n```typescript\nlet allNodes: NodeInfo[] = [];\nlet continuationToken: string | undefined;\n\ndo {\n  const response = await sfApi.getNodeInfoList({\n    continuationToken\n  });\n  \n  allNodes.push(...(response.items || []));\n  continuationToken = response.continuationToken;\n} while (continuationToken);\n```\n\n### Health Response Pattern\nHealth queries return immediate objects (not paged):\n\n```typescript\n// Direct object response\nconst health = await sfApi.getClusterHealth();\nconsole.log(health.aggregatedHealthState);\n\nconst nodeHealth = await sfApi.getNodeHealth(nodeName);\nconsole.log(nodeHealth.aggregatedHealthState);\n```\n\n### Error Handling\n```typescript\ntry {\n  const response = await sfApi.getNodeInfoList();\n  const nodes = response.items || [];\n  \n  if (nodes.length === 0) {\n    SfUtility.outputLog('No nodes found', null, debugLevel.warn);\n  }\n} catch (error) {\n  SfUtility.showError(`Failed to get nodes: ${error.message}`);\n}\n```\n\n### Testing Pattern\n```typescript\n// In tests, always check for paged response\nconst response = await sfApi.getNodeInfoList();\nexpect(response).toBeDefined();\nexpect(response.items).toBeDefined();\nexpect(Array.isArray(response.items)).toBe(true);\n\nconst nodes = response.items || [];\nexpect(nodes.length).toBeGreaterThan(0);\n```\n\n### Verified Working Commands (as of Feb 2026)\n✅ All passive read operations validated:\n- GET /$/GetClusterHealth\n- GET /$/GetClusterManifest\n- GET /Nodes (paginated)\n- GET /Nodes/{nodeName}/$/GetHealth\n- GET /Applications (paginated)\n- GET /Applications/{appId}/$/GetHealth\n- GET /ApplicationTypes (paginated)\n- GET /Applications/{appId}/$/GetServices (paginated)\n- POST /Nodes/{nodeName}/$/Deactivate\n- POST /Nodes/{nodeName}/$/Activate",
  "priority": 0,
  "audience": "agent",
  "requirement": "always",
  "rationale": "Critical pattern for working with Service Fabric SDK - incorrect handling leads to 'not a function' errors",
  "categories": ["service-fabric", "api", "patterns", "pagination"]
}
